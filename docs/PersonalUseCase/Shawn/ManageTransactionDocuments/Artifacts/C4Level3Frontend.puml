@startuml C4Level3Frontend
!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml
scale 0.42
!$ICONURL = "https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v3.0.0/icons"
!include $ICONURL/common.puml
!include $ICONURL/devicons2/spring_original.puml
!include $ICONURL/devicons/react.puml
!include $ICONURL/devicons/html5.puml
!include $ICONURL/devicons/postgresql.puml

AddElementTag("microService-java", $shape=EightSidedShape(), $bgColor="#FFDB33", $borderColor="Black", $fontColor="black", $legendText="Spring Boot Container")
AddElementTag("framework-react", $shape=RoundedBoxShape(), $bgColor="#61DBFB", $borderColor="Black", $fontColor="white", $legendText="React SPA (Vite)")
AddElementTag("shell-infra", $bgColor="#f5f5f5", $borderColor="Black", $fontColor="black", $legendText="Shell & Infrastructure")
AddElementTag("broker-area", $bgColor="#e3f2fd", $borderColor="Black", $fontColor="black", $legendText="Broker Workspace")
AddElementTag("client-area", $bgColor="#e8f5e9", $borderColor="Black", $fontColor="black", $legendText="Client Workspace")
AddElementTag("admin-area", $bgColor="#fff3e0", $borderColor="Black", $fontColor="black", $legendText="Admin Workspace")

AddRelTag("purple-line", $lineColor="purple", $legendText="API Calls (REST)")
AddRelTag("green-line", $lineColor="green", $legendText="Documents (R2)")

LAYOUT_TOP_DOWN()
SHOW_PERSON_OUTLINE()

title CourtierPro â€” C4 Level 3 (Frontend Web SPA Components)

System_Boundary(cp, "CourtierPro System") {

  Person(broker, "Broker", "Licensed real estate broker in Quebec")
  Person(client, "Client", "Buyer/Seller working with the brokerage")
  Person(admin, "Admin", "Administrative staff / system admin")

  Container_Boundary(web_spa, "CourtierPro Web App (React 19 + Vite + TypeScript)", $tags="framework-react") {

    ' Shell & Infrastructure
    Component(AppShell, "Dashboard Shell", "React Router Layout", "AppHeader, Sidebar, route outlet, responsive layout", $tags="shell-infra")
    Component(AuthGuard, "AuthGuard", "React + @auth0/auth0-react", "Protects routes, injects user context and roles", $tags="shell-infra")
    Component(I18nProvider, "I18nProvider", "react-i18next", "EN/FR translations via JSON files in shared/i18n/{en,fr}/", $tags="shell-infra")
    Component(ApiClient, "ApiClient (axiosInstance)", "Axios wrapper", "Central REST client with Auth0 bearer token injection and error handling", $tags="shell-infra")
    Component(QueryClient, "QueryClient", "TanStack React Query", "Server state management with caching, invalidation, and optimistic updates", $tags="shell-infra")
    Component(NotificationCenter, "NotificationCenter", "React Component", "Global notification display and toast alerts", $tags="shell-infra")

    ' Dashboard pages
    Component(BrokerDashboardPage, "BrokerDashboardPage", "React Page", "Broker dashboard: stats, pinned transactions, upcoming appointments, action cards", $tags="broker-area")
    Component(ClientDashboardPage, "ClientDashboardPage", "React Page", "Client dashboard: active transactions count, documents needed", $tags="client-area")
    Component(AdminDashboardPage, "AdminDashboardPage", "React Page", "Admin dashboard: user stats, system health, audit summary", $tags="admin-area")

    ' Transaction pages
    Component(TransactionsPage, "BrokerTransactionsPage", "React Page", "Broker transactions list with filters (status, stage, side)", $tags="broker-area")
    Component(ClientTransactionsPage, "ClientTransactionsPage", "React Page", "Client transaction list view", $tags="client-area")
    Component(TransactionDetailsPage, "TransactionDetailsPage", "React Page", "Transaction detail: timeline, stages, documents tab, appointments tab", $tags="broker-area,client-area")

    ' Document feature components
    Component(DocumentsCenter, "DocumentsCenter", "React Component", "Document list with status filter bar, stage selector, and checklist panel", $tags="broker-area,client-area")
    Component(DocumentCard, "DocumentCard", "React Component", "Single document: version history, status badge, download/upload actions", $tags="broker-area,client-area")
    Component(RequestDocumentModal, "RequestDocumentModal", "React Component", "Broker creates document request (type, party, notes, due date, stage)", $tags="broker-area")
    Component(UploadForClientModal, "UploadForClientModal", "React Component", "Broker uploads document for client (UPLOAD flow)", $tags="broker-area")
    Component(DocumentReviewModal, "DocumentReviewModal", "React Component", "Broker reviews: approve, request revision, or reject with comments", $tags="broker-area")
    Component(StageChecklistPanel, "StageChecklistPanel", "React Component", "Stage-driven document checklist with auto/manual check states", $tags="broker-area")
    Component(OutstandingDocsDashboard, "OutstandingDocumentsDashboard", "React Component", "Broker dashboard: overdue documents with reminder action", $tags="broker-area")

    ' Appointment feature
    Component(AppointmentsPage, "AppointmentsPage", "React Page", "Appointment list/calendar with request, confirm, cancel actions", $tags="broker-area,client-area")

    ' Analytics
    Component(AnalyticsPage, "AnalyticsPage", "React Page", "Broker analytics: metrics, charts, performance data", $tags="broker-area")

    ' Admin pages
    Component(AdminUsersPage, "AdminUsersPage", "React Page", "Manage users: create, activate/deactivate, password reset", $tags="admin-area")
    Component(AdminSettingsPage, "AdminSettingsPage", "React Page", "Organization settings: email templates, defaults", $tags="admin-area")
    Component(AuditPages, "AuditPages", "React Pages", "Login audit, logout audit, password reset audit, system logs", $tags="admin-area")
  }

  Container(backend_api, "CourtierPro Backend API", "Spring Boot 3 (Java 17)", "Domain logic & persistence", $sprite="spring_original", $tags="microService-java")
}

' User relationships
Rel(broker, AppShell, "Uses via browser", "HTTPS")
Rel(client, AppShell, "Uses via browser", "HTTPS")
Rel(admin, AppShell, "Uses via browser", "HTTPS")

' Shell / infrastructure relationships
Rel(AppShell, AuthGuard, "Wraps protected routes")
Rel(AppShell, I18nProvider, "Provides i18n context")
Rel(AppShell, NotificationCenter, "Renders notification region")

' AppShell renders main pages
Rel(AppShell, BrokerDashboardPage, "Renders", "Composition")
Rel(AppShell, ClientDashboardPage, "Renders", "Composition")
Rel(AppShell, AdminDashboardPage, "Renders", "Composition")
Rel(AppShell, TransactionsPage, "Renders", "Composition")
Rel(AppShell, ClientTransactionsPage, "Renders", "Composition")
Rel(AppShell, TransactionDetailsPage, "Renders", "Composition")
Rel(AppShell, AppointmentsPage, "Renders", "Composition")
Rel(AppShell, AnalyticsPage, "Renders", "Composition")
Rel(AppShell, AdminUsersPage, "Renders", "Composition")
Rel(AppShell, AdminSettingsPage, "Renders", "Composition")
Rel(AppShell, AuditPages, "Renders", "Composition")

' Transaction detail page composition
Rel(TransactionDetailsPage, DocumentsCenter, "Embeds documents section", "Composition")

' Documents feature composition
Rel(DocumentsCenter, DocumentCard, "Renders per document", "Composition")
Rel(DocumentsCenter, StageChecklistPanel, "Embeds checklist", "Composition")
Rel(DocumentsCenter, RequestDocumentModal, "Opens on request action", "Composition")
Rel(DocumentsCenter, UploadForClientModal, "Opens on upload-for-client action", "Composition")
Rel(DocumentCard, DocumentReviewModal, "Opens on review action", "Composition")

' Broker dashboard composition
Rel(BrokerDashboardPage, OutstandingDocsDashboard, "Embeds outstanding docs", "Composition")

' All feature components use ApiClient -> QueryClient
Rel(DocumentsCenter, ApiClient, "Uses (React Query hooks)", "JSON/REST", $tags="purple-line,green-line")
Rel(TransactionsPage, ApiClient, "Uses", "JSON/REST", $tags="purple-line")
Rel(AppointmentsPage, ApiClient, "Uses", "JSON/REST", $tags="purple-line")
Rel(BrokerDashboardPage, ApiClient, "Uses", "JSON/REST", $tags="purple-line")
Rel(AdminUsersPage, ApiClient, "Uses", "JSON/REST", $tags="purple-line")
Rel(AdminSettingsPage, ApiClient, "Uses", "JSON/REST", $tags="purple-line")

Rel(ApiClient, QueryClient, "Manages cache")
Rel(ApiClient, backend_api, "Calls", "JSON/REST/HTTPS", $tags="purple-line")

SHOW_LEGEND()
@enduml
