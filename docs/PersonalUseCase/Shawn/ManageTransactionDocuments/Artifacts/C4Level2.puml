@startuml C4Level2
!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Container.puml
scale 0.42
!$ICONURL = "https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v3.0.0/icons"
!include $ICONURL/common.puml
!include $ICONURL/devicons2/spring_original.puml
!include $ICONURL/devicons/react.puml
!include $ICONURL/devicons/html5.puml
!include $ICONURL/devicons/postgresql.puml
!include $ICONURL/font-awesome-5/envelope.puml
!include $ICONURL/font-awesome-5/cloud.puml
!include $ICONURL/font-awesome-5/user.puml

AddElementTag("microService-java", $shape=EightSidedShape(), $bgColor="#6DB33F", $fontColor="black", $legendText="Spring Boot Container")
AddElementTag("framework-react", $shape=RoundedBoxShape(), $bgColor="#61DBFB", $fontColor="white", $legendText="React SPA (Vite)")
AddElementTag("storage-postgres", $shape=RoundedBoxShape(), $bgColor="#336791", $borderColor="Black", $fontColor="white", $legendText="PostgreSQL 15")
AddElementTag("webApp", $bgColor="#e34f26", $fontColor="white", $legendText="Web Application (HTML5)")

AddRelTag("purple-line", $lineColor="purple", $legendText="API Calls (REST)")
AddRelTag("blue-line", $lineColor="blue", $legendText="Auth / Sessions")
AddRelTag("green-line", $lineColor="green", $legendText="Documents (R2)")

LAYOUT_TOP_DOWN()
SHOW_PERSON_OUTLINE()

title CourtierPro â€” C4 Level 2 (Containers)

System_Boundary(cp, "CourtierPro System") {
    Container(frontend_app, "Static Hosting (delivery)", "Nginx (VM) / HTML5/CSS", "Delivers the static site shell and the React SPA build.", $sprite="html5", $tags="webApp")
    Container(web_spa, "CourtierPro Web App", "React 19 + Vite + TypeScript", "Single-page application with role-based views (Broker, Client, Admin); bilingual i18n (EN/FR). Uses shadcn/ui (Radix), TanStack React Query, react-hook-form + Zod, Tailwind CSS 4.", $sprite="react", $tags="framework-react")
    Container(backend_api, "CourtierPro Backend API", "Spring Boot 3 (Java 17)", "REST/JSON API over HTTPS; OAuth2 resource server, layered DDD architecture, business logic, file management via pre-signed URLs, email notifications.", $sprite="spring_original", $tags="microService-java")
    ContainerDb(main_db, "courtierpro-db", "PostgreSQL 15", "Shared schema with bounded-context-owned tables. Flyway migrations (V1__init_schema.sql).", $sprite="postgresql", $tags="storage-postgres")
}

together {
Person(broker, "Broker", "Licensed real estate broker in Quebec; manages client files, stages, appointments, and analytics.")
Person(client, "Client", "Buyer/Seller; views transaction progress, uploads documents, requests appointments.")
Person(admin, "Admin", "System administrator; manages users, roles, organization settings, audit logs.")
}

together {
System_Ext(auth0, "Auth0", "Identity provider for OAuth2/OIDC authentication and role management (ADMIN, BROKER, CLIENT).")
System_Ext(r2, "Cloudflare R2", "S3-compatible object storage for uploaded documents and offer attachments.")
System_Ext(ses, "AWS SES", "Transactional email delivery with bilingual template support (EN/FR).")
}

Rel(broker, frontend_app, "Visits", "HTTPS")
Rel(client, frontend_app, "Visits", "HTTPS")
Rel(admin, frontend_app, "Visits", "HTTPS")
Rel_R(frontend_app, web_spa, "Delivers SPA")

Rel(broker, web_spa, "Uses", "HTTPS")
Rel(client, web_spa, "Uses", "HTTPS")
Rel(admin, web_spa, "Uses", "HTTPS")

Rel(web_spa, backend_api, "API calls", "JSON/REST/HTTPS", $tags="purple-line")
Rel(backend_api, main_db, "Reads/Writes", "JDBC (HikariCP)")

Rel(backend_api, auth0, "Validates JWT tokens", "HTTPS/OIDC", $tags="blue-line")
Rel(web_spa, auth0, "Login redirect / token refresh", "HTTPS/OIDC", $tags="blue-line")
Rel(backend_api, r2, "Upload/download via pre-signed URLs", "HTTPS/S3 API", $tags="green-line")
Rel(backend_api, ses, "Sends transactional emails", "HTTPS")

SHOW_LEGEND()
@enduml
