@startuml ActivityDiagram
!theme plain
skinparam backgroundColor #FEFEFE
skinparam ActivityBackgroundColor #E8F4FD
skinparam ActivityBorderColor #1976D2
skinparam ActivityFontSize 12
skinparam ArrowColor #424242
skinparam PartitionBackgroundColor #F5F5F5
skinparam PartitionBorderColor #BDBDBD
skinparam DiamondBackgroundColor #FFF9C4
skinparam DiamondBorderColor #F9A825

title **Manage Transaction Documents**

start

partition "**1. Request Document** (Broker)" #E3F2FD {
  :Broker opens document requests for transaction;
  :Fill form: type, expected party, notes;
  :Submit request;
  
  if (Valid?) then (yes)
    :Create request (REQUESTED);
    :Notify Client;
  else (no)
    :Show errors;
    stop
  endif
}

partition "**2. Submit Document** (Client)" #E8F5E9 {
  :Client views pending requests;
  :Upload file;
  
  if (Valid file?) then (yes)
    :Store in Cloudflare R2;
    :Update status → SUBMITTED;
    :Notify Broker;
  else (no)
    :Show error, retry;
    stop
  endif
}

partition "**3. Review Document** (Broker)" #FFF3E0 {
  :Broker downloads and reviews;
  
  switch (Decision)
  case (Approve)
    :Status → APPROVED;
    :Notify Client ✓;
  case (Revise)
    :Status → NEEDS_REVISION;
    :Send feedback;
    note right: Client resubmits
  case (Reject)
    :Status → REJECTED;
    :Notify Client ✗;
  endswitch
}

stop

legend right
  |= Color |= Actor |
  | <#E3F2FD> | Broker |
  | <#E8F5E9> | Client |
  | <#FFF3E0> | Review |
endlegend

@enduml
