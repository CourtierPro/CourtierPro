@startuml Relationships
skinparam classAttributeIconSize 0
skinparam linetype ortho
hide members

title Design Level Class Diagram: Relationships Overview

package "Presentation Layer" #LightBlue {
  class DocumentController
  class GlobalDocumentController
  class DocumentRequestDTO
  class DocumentResponseDTO
  class DocumentReviewRequestDTO
  class DocumentVersionResponseDTO
  class OutstandingDocumentDTO
  class StageChecklistResponseDTO
  class StageChecklistItemDTO
  class ChecklistToggleRequestDTO
}

package "Business Layer" #LightGreen {
  interface DocumentService
  class DocumentServiceImpl
  class StageDocumentTemplateRegistry
  interface NotificationService
  class EmailService
}

package "Data Layer" #LightYellow {
  interface DocumentRepository
  interface TransactionRepository
  interface UserAccountRepository
  interface ChecklistStateRepository
  class Document <<Entity>>
  class DocumentVersion <<Entity>>
  class TransactionStageChecklistState <<Entity>>
  class TransactionRef <<Value Object>>
  class StorageObject <<Value Object>>
  class UploadedBy <<Value Object>>
}

package "Infrastructure Layer" #LightCoral {
  interface ObjectStorageService
  class ObjectStorageServiceImpl
}

package "Enums" #LightGray {
  enum DocumentTypeEnum
  enum DocumentStatusEnum
  enum DocumentPartyEnum
  enum DocumentFlowEnum
  enum UploadedByRefEnum
  enum StageEnum
}

' ==========================================
' PRESENTATION LAYER - Internal
' ==========================================
DocumentController ..> DocumentRequestDTO : receives
DocumentController ..> DocumentResponseDTO : returns
DocumentController ..> DocumentReviewRequestDTO : receives
DocumentController ..> StageChecklistResponseDTO : returns
GlobalDocumentController ..> OutstandingDocumentDTO : returns
DocumentResponseDTO ..> DocumentVersionResponseDTO : contains
StageChecklistResponseDTO ..> StageChecklistItemDTO : contains

' ==========================================
' BUSINESS LAYER - Internal
' ==========================================
DocumentServiceImpl ..|> DocumentService : implements
DocumentServiceImpl --> NotificationService : uses
DocumentServiceImpl --> EmailService : uses
DocumentServiceImpl --> StageDocumentTemplateRegistry : uses

' ==========================================
' DATA LAYER - Internal
' ==========================================
DocumentRepository ..> Document : persists
ChecklistStateRepository ..> TransactionStageChecklistState : persists
Document "1" *-- "1" TransactionRef : contains
Document "1" *-- "0..*" DocumentVersion : contains
DocumentVersion "1" *-- "1" StorageObject : contains
DocumentVersion "1" *-- "1" UploadedBy : contains

' ==========================================
' INFRASTRUCTURE LAYER - Internal
' ==========================================
ObjectStorageServiceImpl ..|> ObjectStorageService : implements

' ==========================================
' CROSS-PACKAGE: Presentation -> Business
' ==========================================
DocumentController --> DocumentService : uses
GlobalDocumentController --> DocumentService : uses

' ==========================================
' CROSS-PACKAGE: Business -> Data
' ==========================================
DocumentServiceImpl --> DocumentRepository : uses
DocumentServiceImpl --> TransactionRepository : uses
DocumentServiceImpl --> UserAccountRepository : uses
DocumentServiceImpl --> ChecklistStateRepository : uses
DocumentServiceImpl ..> Document : manages

' ==========================================
' CROSS-PACKAGE: Business -> Infrastructure
' ==========================================
DocumentServiceImpl --> ObjectStorageService : uses

' ==========================================
' CROSS-PACKAGE: Business -> Presentation (DTOs)
' ==========================================
DocumentServiceImpl ..> DocumentResponseDTO : creates

' ==========================================
' DATA -> ENUMS
' ==========================================
Document --> DocumentTypeEnum
Document --> DocumentStatusEnum
Document --> DocumentPartyEnum
Document --> DocumentFlowEnum
Document --> StageEnum
DocumentVersion --> UploadedByRefEnum
TransactionStageChecklistState --> StageEnum

@enduml
